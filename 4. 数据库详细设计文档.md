##  数据库详细设计文档

### 数据库ER图

text

```
患者(patient) ────── 预约记录(appointment) ────── 排班(schedule)
     │                      │                          │
     │                      │                          │
     │                      │                          │
     │                      ├──── 病例(medical_record) │
     │                      │                          │
     │                      ├──── 处方(prescription) ─┤
     │                      │         │                │
     │                      │         └─ 处方明细(prescription_item) ─ 药品(medicine)
     │                      │
     │                      └──── 支付订单(payment)
     │
     └──── 系统用户(sys_user)

医生(doctor) ────── 排班(schedule)
     │
     ├──── 调班申请(schedule_adjustment)
     │
     └──── 诊室(consulting_room)

科室(department) ────── 医生(doctor)
     │
     ├──── 排班(schedule)
     │
     └──── 诊室(consulting_room)
```

### 数据表结构

####  患者表 (patient)

| 字段名          | 类型     | 长度 | 主键 | 可空 | 说明            |
| --------------- | -------- | ---- | ---- | ---- | --------------- |
| id              | bigint   | 20   | 是   | 否   | 患者ID          |
| name            | varchar  | 50   | 否   | 否   | 姓名            |
| id_card         | varchar  | 18   | 否   | 否   | 身份证号        |
| phone           | varchar  | 11   | 否   | 否   | 手机号          |
| gender          | tinyint  | 1    | 否   | 否   | 性别(0-女,1-男) |
| birthday        | date     | -    | 否   | 是   | 出生日期        |
| allergy_history | text     | -    | 否   | 是   | 过敏史          |
| create_time     | datetime | -    | 否   | 否   | 创建时间        |

#### 医生表 (doctor)

| 字段名        | 类型    | 长度 | 主键 | 可空 | 说明                |
| ------------- | ------- | ---- | ---- | ---- | ------------------- |
| id            | bigint  | 20   | 是   | 否   | 医生ID              |
| name          | varchar | 50   | 否   | 否   | 医生姓名            |
| department_id | bigint  | 20   | 否   | 否   | 科室ID              |
| title         | varchar | 20   | 否   | 否   | 职称                |
| specialty     | varchar | 100  | 否   | 是   | 专长                |
| introduction  | text    | -    | 否   | 是   | 简介                |
| status        | tinyint | 1    | 否   | 否   | 状态(0-停用,1-启用) |

#### 排班表 (schedule)

| 字段名         | 类型    | 长度 | 主键 | 可空 | 说明                |
| -------------- | ------- | ---- | ---- | ---- | ------------------- |
| id             | bigint  | 20   | 是   | 否   | 排班ID              |
| doctor_id      | bigint  | 20   | 否   | 否   | 医生ID              |
| department_id  | bigint  | 20   | 否   | 否   | 科室ID              |
| schedule_date  | date    | -    | 否   | 否   | 排班日期            |
| time_slot      | varchar | 20   | 否   | 否   | 时间段              |
| total_count    | int     | 11   | 否   | 否   | 总号源数            |
| reserved_count | int     | 11   | 否   | 否   | 已预约数            |
| status         | tinyint | 1    | 否   | 否   | 状态(0-停诊,1-正常) |

####  预约记录表 (appointment)

| 字段名         | 类型     | 长度 | 主键 | 可空 | 说明                             |
| -------------- | -------- | ---- | ---- | ---- | -------------------------------- |
| id             | bigint   | 20   | 是   | 否   | 预约ID                           |
| patient_id     | bigint   | 20   | 否   | 否   | 患者ID                           |
| doctor_id      | bigint   | 20   | 否   | 否   | 医生ID                           |
| schedule_id    | bigint   | 20   | 否   | 否   | 排班ID                           |
| appointment_no | varchar  | 20   | 否   | 否   | 预约号                           |
| appointment_date| date    | -    | 否   | 否   | 预约日期                         |
| time_slot      | varchar  | 20   | 否   | 否   | 时间段                           |
| status         | tinyint  | 1    | 否   | 否   | 状态(1-待支付,2-已预约,3-已取消,4-已完成) |
| cancel_time    | datetime | -    | 否   | 是   | 取消时间                                   |
| cancel_reason  | varchar  | 500  | 否   | 是   | 取消原因                                   |
| payment_time   | datetime | -    | 否   | 是   | 支付时间                                   |
| complete_time  | datetime | -    | 否   | 是   | 完成时间                                   |
| fee            | decimal  | 10,2 | 否   | 否   | 挂号费                           |
| create_time    | datetime | -    | 否   | 否   | 创建时间                         |
| update_time    | datetime | -    | 否   | 否   | 更新时间                         |

#### 患者表补充字段

| 字段名       | 类型   | 长度 | 主键 | 可空 | 说明                    |
| ------------ | ------ | ---- | ---- | ---- | ----------------------- |
| credit_score | int    | 11   | 否   | 是   | 诚信度分数(0-100,默认100) |

#### 诊室表 (consulting_room)

| 字段名        | 类型     | 长度 | 主键 | 可空 | 说明                |
| ------------- | -------- | ---- | ---- | ---- | ------------------- |
| id            | bigint   | 20   | 是   | 否   | 诊室ID              |
| room_no       | varchar  | 20   | 否   | 否   | 诊室编号            |
| name          | varchar  | 50   | 否   | 否   | 诊室名称            |
| department_id | bigint   | 20   | 否   | 否   | 所属科室ID          |
| doctor_id     | bigint   | 20   | 否   | 是   | 所属医生ID          |
| location      | varchar  | 100  | 否   | 是   | 位置                |
| status        | tinyint  | 1    | 否   | 否   | 状态(0-停用,1-启用) |
| create_time   | datetime | -    | 否   | 否   | 创建时间            |
| update_time   | datetime | -    | 否   | 否   | 更新时间            |

#### 调班申请表 (schedule_adjustment)

| 字段名           | 类型     | 长度 | 主键 | 可空 | 说明                           |
| ---------------- | -------- | ---- | ---- | ---- | ------------------------------ |
| id               | bigint   | 20   | 是   | 否   | 调班申请ID                     |
| doctor_id        | bigint   | 20   | 否   | 否   | 医生ID                         |
| schedule_id      | bigint   | 20   | 否   | 否   | 排班ID                         |
| original_date    | date     | -    | 否   | 否   | 原排班日期                     |
| original_time_slot| varchar  | 20   | 否   | 否   | 原时间段                       |
| new_date         | date     | -    | 否   | 是   | 新排班日期                     |
| new_time_slot    | varchar  | 20   | 否   | 是   | 新时间段                       |
| reason           | varchar  | 500  | 否   | 是   | 调班原因                       |
| status           | tinyint  | 1    | 否   | 否   | 状态(0-待审核,1-已通过,2-已拒绝) |
| reviewer_id      | bigint   | 20   | 否   | 是   | 审核人ID（管理员）             |
| review_comment   | varchar  | 500  | 否   | 是   | 审核意见                       |
| create_time      | datetime | -    | 否   | 否   | 创建时间                       |
| update_time      | datetime | -    | 否   | 否   | 更新时间                       |

#### 系统用户表 (sys_user)

| 字段名     | 类型     | 长度 | 主键 | 可空 | 说明                           |
| ---------- | -------- | ---- | ---- | ---- | ------------------------------ |
| id         | bigint   | 20   | 是   | 否   | 用户ID                         |
| username   | varchar  | 50   | 否   | 否   | 用户名                         |
| password   | varchar  | 255  | 否   | 否   | 密码(BCrypt加密)               |
| phone      | varchar  | 11   | 否   | 否   | 手机号                         |
| user_type  | tinyint  | 1    | 否   | 否   | 用户类型(1-患者,2-医生,3-管理员) |
| patient_id | bigint   | 20   | 否   | 是   | 患者ID                         |
| doctor_id  | bigint   | 20   | 否   | 是   | 医生ID                         |
| status     | tinyint  | 1    | 否   | 否   | 状态(0-禁用,1-启用)            |
| create_time| datetime | -    | 否   | 否   | 创建时间                       |

#### 病例表 (medical_record)

| 字段名        | 类型     | 长度 | 主键 | 可空 | 说明     |
| ------------- | -------- | ---- | ---- | ---- | -------- |
| id            | bigint   | 20   | 是   | 否   | 病例ID   |
| appointment_id| bigint   | 20   | 否   | 否   | 预约ID   |
| patient_id    | bigint   | 20   | 否   | 否   | 患者ID   |
| doctor_id     | bigint   | 20   | 否   | 否   | 医生ID   |
| diagnosis     | text     | -    | 否   | 是   | 诊断结果 |
| symptoms      | text     | -    | 否   | 是   | 症状描述 |
| advice        | text     | -    | 否   | 是   | 医嘱建议 |
| create_time   | datetime | -    | 否   | 否   | 创建时间 |
| update_time   | datetime | -    | 否   | 否   | 更新时间 |

#### 处方表 (prescription)

| 字段名          | 类型     | 长度 | 主键 | 可空 | 说明                    |
| --------------- | -------- | ---- | ---- | ---- | ----------------------- |
| id              | bigint   | 20   | 是   | 否   | 处方ID                  |
| medical_record_id| bigint  | 20   | 否   | 否   | 病例ID                  |
| appointment_id  | bigint   | 20   | 否   | 否   | 预约ID                  |
| total_amount    | decimal  | 10,2 | 否   | 否   | 处方总金额              |
| status          | tinyint  | 1    | 否   | 否   | 状态(1-待支付,2-已支付) |
| create_time     | datetime | -    | 否   | 否   | 创建时间                |
| update_time     | datetime | -    | 否   | 否   | 更新时间                |

#### 处方明细表 (prescription_item)

| 字段名        | 类型     | 长度 | 主键 | 可空 | 说明           |
| ------------- | -------- | ---- | ---- | ---- | -------------- |
| id            | bigint   | 20   | 是   | 否   | 明细ID         |
| prescription_id| bigint  | 20   | 否   | 否   | 处方ID         |
| medicine_id   | bigint   | 20   | 否   | 否   | 药品ID         |
| quantity      | int      | 11   | 否   | 否   | 数量           |
| price         | decimal  | 10,2 | 否   | 否   | 单价（快照）   |
| subtotal      | decimal  | 10,2 | 否   | 否   | 小计           |
| create_time   | datetime | -    | 否   | 否   | 创建时间       |

#### 支付订单表 (payment)

| 字段名        | 类型     | 长度 | 主键 | 可空 | 说明                                    |
| ------------- | -------- | ---- | ---- | ---- | --------------------------------------- |
| id            | bigint   | 20   | 是   | 否   | 订单ID                                  |
| appointment_id| bigint   | 20   | 否   | 否   | 预约ID                                  |
| order_no      | varchar  | 50   | 否   | 否   | 订单号                                  |
| amount        | decimal  | 10,2 | 否   | 否   | 金额                                    |
| payment_method| tinyint  | 1    | 否   | 是   | 支付方式(1-微信,2-支付宝,3-医保,4-现金) |
| status        | tinyint  | 1    | 否   | 否   | 状态(1-待支付,2-已支付,3-已退款)        |
| pay_time      | datetime | -    | 否   | 是   | 支付时间                                |
| order_type    | tinyint  | 1    | 否   | 否   | 订单类型(1-挂号费,2-药品费,3-合并订单) |
| prescription_id| bigint  | 20   | 否   | 是   | 处方ID（如果是药品订单）                |
| create_time   | datetime | -    | 否   | 否   | 创建时间                                |
| update_time   | datetime | -    | 否   | 否   | 更新时间                                |

#### 药品表 (medicine)

| 字段名        | 类型     | 长度 | 主键 | 可空 | 说明                |
| ------------- | -------- | ---- | ---- | ---- | ------------------- |
| id            | bigint   | 20   | 是   | 否   | 药品ID              |
| name          | varchar  | 100  | 否   | 否   | 药品名称            |
| price         | decimal  | 10,2 | 否   | 否   | 单价                |
| unit          | varchar  | 20   | 否   | 否   | 单位（盒/瓶/片等）  |
| specification | varchar  | 100  | 否   | 是   | 规格                |
| stock         | int      | 11   | 否   | 否   | 库存数量            |
| status        | tinyint  | 1    | 否   | 否   | 上架状态(0-下架,1-上架) |
| category      | varchar  | 50   | 否   | 是   | 药品分类            |
| create_time   | datetime | -    | 否   | 否   | 创建时间            |
| update_time   | datetime | -    | 否   | 否   | 更新时间            |

### 索引设计

sql

```
-- 患者表索引
CREATE INDEX idx_patient_phone ON patient(phone);
CREATE INDEX idx_patient_id_card ON patient(id_card);

-- 预约记录表索引
CREATE INDEX idx_appointment_patient_id ON appointment(patient_id);
CREATE INDEX idx_appointment_schedule_id ON appointment(schedule_id);
CREATE INDEX idx_appointment_create_time ON appointment(create_time);

-- 排班表索引
CREATE INDEX idx_schedule_doctor_date ON schedule(doctor_id, schedule_date);
CREATE INDEX idx_schedule_department_date ON schedule(department_id, schedule_date);

-- 诊室表索引
CREATE INDEX idx_consulting_room_department_id ON consulting_room(department_id);
CREATE INDEX idx_consulting_room_doctor_id ON consulting_room(doctor_id);

-- 调班申请表索引
CREATE INDEX idx_schedule_adjustment_doctor_id ON schedule_adjustment(doctor_id);
CREATE INDEX idx_schedule_adjustment_schedule_id ON schedule_adjustment(schedule_id);
CREATE INDEX idx_schedule_adjustment_status ON schedule_adjustment(status);

-- 系统用户表索引
CREATE INDEX idx_sys_user_username ON sys_user(username);
CREATE INDEX idx_sys_user_phone ON sys_user(phone);

-- 病例表索引
CREATE INDEX idx_medical_record_appointment_id ON medical_record(appointment_id);
CREATE INDEX idx_medical_record_patient_id ON medical_record(patient_id);
CREATE INDEX idx_medical_record_doctor_id ON medical_record(doctor_id);

-- 处方表索引
CREATE INDEX idx_prescription_medical_record_id ON prescription(medical_record_id);
CREATE INDEX idx_prescription_appointment_id ON prescription(appointment_id);
CREATE INDEX idx_prescription_status ON prescription(status);

-- 处方明细表索引
CREATE INDEX idx_prescription_item_prescription_id ON prescription_item(prescription_id);
CREATE INDEX idx_prescription_item_medicine_id ON prescription_item(medicine_id);

-- 支付订单表索引
CREATE INDEX idx_payment_appointment_id ON payment(appointment_id);
CREATE INDEX idx_payment_order_no ON payment(order_no);
CREATE INDEX idx_payment_status ON payment(status);
CREATE INDEX idx_payment_order_type ON payment(order_type);
CREATE INDEX idx_payment_prescription_id ON payment(prescription_id);

-- 药品表索引
CREATE INDEX idx_medicine_name ON medicine(name);
CREATE INDEX idx_medicine_status ON medicine(status);
CREATE INDEX idx_medicine_category ON medicine(category);
```