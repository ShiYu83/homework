# 后端启动问题解决方案

## 已发现和修复的问题

### 1. ✅ 端口9090被占用
**问题描述：** 启动时提示 "Port 9090 was already in use"

**解决方案：**
- 检查占用端口的进程：`netstat -ano | findstr :9090`
- 终止占用端口的进程：`taskkill /F /PID <进程ID>`
- 或修改端口：编辑 `application.yml`，将 `server.port` 改为其他端口（如8081）

### 2. ✅ Redis连接配置优化
**问题描述：** 如果Redis未运行，可能导致启动失败

**已修复：**
- 更新了 `RedisConfig.java`，使Redis连接失败时不阻止应用启动
- Redis连接失败时只会记录警告，应用仍可正常启动

### 3. ✅ 数据库连接
**说明：** 数据库连接是必需的，如果连接失败应用无法启动

**检查清单：**
- ✅ MySQL服务是否运行（Docker容器或本地服务）
- ✅ 数据库配置是否正确（`application-dev.yml`）
- ✅ 数据库用户权限是否正确
- ✅ 数据库 `hospital` 是否存在

## 启动步骤

### 方法1：使用Maven命令启动
```bash
cd hospital-backend
mvn spring-boot:run
```

### 方法2：使用启动脚本
```bash
# Windows
启动后端.bat

# Linux/Mac
./start.sh
```

### 方法3：打包后运行
```bash
cd hospital-backend
mvn clean package -DskipTests
java -jar target/hospital-backend-1.0.0.jar
```

## 启动前检查清单

1. ✅ **Java版本**
   - 需要Java 17或更高版本
   - 检查：`java -version`

2. ✅ **Maven已安装**
   - 检查：`mvn -version`

3. ✅ **MySQL服务运行**
   - Docker: `docker ps | grep mysql`
   - 本地: 检查MySQL服务状态

4. ✅ **端口9090未被占用**
   - Windows: `netstat -ano | findstr :9090`
   - Linux/Mac: `lsof -i :9090`

5. ✅ **数据库配置正确**
   - 检查 `application-dev.yml` 中的数据库连接信息
   - 默认配置：
     - URL: `jdbc:mysql://localhost:3306/hospital`
     - 用户名: `hospital_user`
     - 密码: `hospital123`

6. ✅ **Redis（可选）**
   - Redis未运行时，应用仍可启动，但Redis功能不可用
   - 如需Redis功能，请启动Redis服务

## 常见错误及解决方案

### 错误1：数据库连接失败
```
数据库连接失败: Communications link failure
```

**解决方案：**
1. 检查MySQL服务是否运行
2. 检查数据库配置是否正确
3. 检查防火墙设置
4. 等待MySQL完全启动（Docker容器启动需要10-15秒）

### 错误2：端口被占用
```
Web server failed to start. Port 9090 was already in use.
```

**解决方案：**
1. 查找占用端口的进程并终止
2. 或修改应用端口配置

### 错误3：编译错误
```
COMPILATION ERROR
```

**解决方案：**
1. 清理并重新编译：`mvn clean compile`
2. 检查Java版本是否为17+
3. 检查依赖是否完整：`mvn dependency:resolve`

### 错误4：Redis连接失败（警告）
```
Redis连接失败，应用将继续启动但Redis功能不可用
```

**说明：** 这是警告，不是错误。应用仍可正常启动，只是Redis功能不可用。

**解决方案：**
- 如需Redis功能，请启动Redis服务
- 或忽略此警告（如果不需要Redis功能）

## 验证启动成功

启动成功后，您应该看到：
1. 日志显示 "Started HospitalApplication"
2. 可以访问：http://localhost:9090
3. 可以访问健康检查：http://localhost:9090/api/health

## 调试技巧

1. **查看详细日志**
   - 启动时添加参数：`mvn spring-boot:run -Dspring-boot.run.arguments=--debug`

2. **检查数据库连接**
   - 查看启动日志中的数据库连接信息
   - 使用数据库客户端工具测试连接

3. **检查端口占用**
   - Windows: `netstat -ano | findstr :9090`
   - Linux/Mac: `lsof -i :9090`

4. **查看完整错误信息**
   - 查看控制台输出的完整堆栈跟踪
   - 检查日志文件（如果配置了日志文件）

## 联系支持

如果以上方法都无法解决问题，请提供以下信息：
1. 完整的错误日志
2. Java版本：`java -version`
3. Maven版本：`mvn -version`
4. 操作系统信息
5. 数据库服务状态

